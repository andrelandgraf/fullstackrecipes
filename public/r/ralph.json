{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ralph",
  "title": "Ralph Agent Loop",
  "description": "Automated agent-driven development loop. Runs AI agents to implement features from user stories, verify acceptance criteria, and log progress for the next agent.",
  "files": [
    {
      "path": "scripts/ralph/runner.ts",
      "content": "#!/usr/bin/env bun\n\nimport { spawn } from \"bun\";\nimport { join, dirname } from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport { parseArgs } from \"node:util\";\n\nconst FINISH_SIGNAL = \"FINISHED ALL FEATURE WORK\";\n\nconst scriptDir = dirname(fileURLToPath(import.meta.url));\nconst promptPath = join(scriptDir, \"prompt.md\");\n\nconst { values } = parseArgs({\n  args: Bun.argv.slice(2),\n  options: {\n    prompt: { type: \"string\" },\n  },\n});\n\nasync function runClaude(): Promise<boolean> {\n  const baselinePrompt = await Bun.file(promptPath).text();\n\n  const prompt = values.prompt\n    ? `Follow this correction/override prompt: ${values.prompt} -\\n\\nBaseline prompt: ${baselinePrompt}`\n    : baselinePrompt;\n\n  const escapedPrompt = prompt.replace(/'/g, \"'\\\\''\");\n\n  const proc = spawn({\n    cmd: [\n      \"sh\",\n      \"-c\",\n      `claude --print '${escapedPrompt}' --dangerously-skip-permissions --verbose --output-format stream-json | jq`,\n    ],\n    stdout: \"pipe\",\n    stderr: \"inherit\",\n  });\n\n  let output = \"\";\n\n  const reader = proc.stdout.getReader();\n  const decoder = new TextDecoder();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    if (done) break;\n\n    const chunk = decoder.decode(value, { stream: true });\n    output += chunk;\n    process.stdout.write(chunk);\n\n    if (output.includes(FINISH_SIGNAL)) {\n      console.log(\"\\n\\n[runner] Detected finish signal. Exiting...\");\n      proc.kill();\n      return true;\n    }\n  }\n\n  await proc.exited;\n\n  if (output.includes(FINISH_SIGNAL)) {\n    console.log(\"\\n\\n[runner] Detected finish signal. Exiting...\");\n    return true;\n  }\n\n  return false;\n}\n\nasync function main() {\n  console.log(\"[runner] Starting Ralph agent loop...\\n\");\n\n  let iteration = 1;\n  while (true) {\n    console.log(`\\n[runner] === Iteration ${iteration} ===\\n`);\n\n    const finished = await runClaude();\n    if (finished) {\n      console.log(\"[runner] All feature work completed!\");\n      process.exit(0);\n    }\n\n    iteration++;\n    console.log(\"\\n[runner] Restarting claude...\\n\");\n  }\n}\n\nmain().catch((err) => {\n  console.error(\"[runner] Error:\", err);\n  process.exit(1);\n});\n",
      "type": "registry:lib",
      "target": "scripts/ralph/runner.ts"
    },
    {
      "path": "scripts/ralph/prompt.md",
      "content": "# Ralph Agent Instructions\n\n**CRITICAL: You must implement EXACTLY ONE feature per session. Never attempt to implement multiple features. After completing one feature, stop and let the next agent session handle the next feature.**\n\n1. The dev server should be running on `http://localhost:3000`. If not, start it with `bun run dev`.\n\n2. Read `scripts/ralph/log.md` file to understand what previous agents have completed.\n\n3. Research `docs/user-stories/` directory for features that have not been implemented yet by searching for `\"passes\": false`.\n\n4. Pick ONE feature - the highest priority non-passing feature based on your own judgement of what should be implemented next logically. Order is determined by dependencies and your judgement - it does not need to be top to bottom.\n\n5. Implement that single feature until all acceptance criteria pass.\n\nMake sure to generate and migrate the db schema if needed:\n\n```bash\nbun run db:generate\nbun run db:migrate\n```\n\nYou're connected to a test database, so make use of the migrate command. Avoid interacting with the database directly.\n\n6. Write tests for the feature. Follow the current test file structure and write tests for the feature.\n\n7. Format the code: `bun run fmt`\n\n8. Verify the feature by doing the following steps:\n\n- Run typecheck: `bun run typecheck`\n- Run build: `bun run build`\n- Run tests: `bun run test`\n\n9. Use the Playwright MCP server to interact with the application and verify the feature.\n\n10. Once it passes, update the user story file's `passes` property to `true`.\n\n11. Append to `scripts/ralph/log.md` with your changes to inform the next agent what you did - keep it short but helpful.\n\n12. Commit your changes with a descriptive commit message summarizing the feature you implemented.\n\n13. **STOP HERE.** Do not continue to implement more features. Go through all user stories. If there are no more files with `\"passes\": false`, respond with exactly:\n\n```\nFINISHED ALL FEATURE WORK\n```\n\nOtherwise, stop and let the next agent session pick up the next feature.\n",
      "type": "registry:lib",
      "target": "scripts/ralph/prompt.md"
    },
    {
      "path": "scripts/ralph/log.md",
      "content": "# Ralph Agent Log\n\nThis file tracks what each agent run has completed. Append your changes below.\n\n---\n\n## 2026-01-09 - Example Entry (Template)\n\n**Task:** Brief description of the task or user story worked on\n\n**Changes:**\n\n- `src/components/example.tsx` - Added new component for X\n- `src/lib/example/queries.ts` - Created query function for Y\n\n**Status:** Completed | In Progress | Blocked\n\n**Notes:** Any relevant context, blockers, or follow-up items\n\n---\n",
      "type": "registry:lib",
      "target": "scripts/ralph/log.md"
    }
  ],
  "docs": "Requires Claude Code CLI: npm install -g @anthropic-ai/claude-code. Add 'ralph': 'bun run scripts/ralph/runner.ts' to package.json scripts. Create docs/user-stories/ directory for acceptance criteria.",
  "type": "registry:lib"
}
