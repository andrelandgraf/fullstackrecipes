{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "validate-config",
  "type": "registry:lib",
  "title": "Environment Variable Validation",
  "description": "Type-safe environment variable validation using Zod with clear error messages. Validates config at startup and provides full TypeScript autocompletion.",
  "dependencies": ["zod"],
  "files": [
    {
      "path": "src/lib/common/validate-config.ts",
      "content": "import { z } from \"zod\";\n\n/**\n * Makes all properties potentially undefined, with special handling for string enums.\n * Used to type raw config objects before Zod validation since `process.env.*` returns\n * `string | undefined`.\n *\n * @example\n * ```ts\n * type Config = { url: string; port: number; nested: { key: string } };\n * type Raw = PreValidate<Config>;\n * // Result: { url: string | undefined; port: number | undefined; nested: { key: string | undefined } | undefined }\n * ```\n */\nexport type PreValidate<ConfigData> = {\n  [K in keyof ConfigData]: ConfigData[K] extends object\n    ? PreValidate<ConfigData[K]> | undefined\n    : ConfigData[K] extends string\n      ? string | undefined\n      : ConfigData[K] | undefined;\n};\n\n/**\n * Error thrown when configuration validation fails.\n * Provides detailed error messages listing all missing or invalid environment variables.\n *\n * @example\n * ```\n * Error [InvalidConfigurationError]: Configuration validation error! Did you correctly set all required environment variables in .env file?\n *  - DATABASE_URL must be defined. (at path: url)\n *  - API_KEY must be defined. (at path: apiKey)\n * ```\n */\nexport class InvalidConfigurationError extends Error {\n  constructor(issues: z.ZodError[\"issues\"]) {\n    let errorMessage =\n      \"Configuration validation error! Did you correctly set all required environment variables in .env file?\";\n    for (const issue of issues) {\n      errorMessage = `${errorMessage}\\n - ${issue.message} (at path: ${issue.path.join(\".\")})`;\n    }\n    super(errorMessage);\n    this.name = \"InvalidConfigurationError\";\n  }\n}\n\n/**\n * Validates a config object against a Zod schema.\n * Returns the validated and typed config, or throws `InvalidConfigurationError` if validation fails.\n *\n * @param schema - Zod schema defining the expected config shape and validation rules\n * @param config - Raw config object with values from `process.env`\n * @returns Validated config object with full type safety\n * @throws {InvalidConfigurationError} When any required env vars are missing or invalid\n *\n * @example\n * ```ts\n * // Define a schema for your feature's config\n * const DatabaseConfigSchema = z.object({\n *   url: z.string(\"DATABASE_URL must be defined.\"),\n *   poolSize: z.coerce.number().default(10),\n * });\n *\n * type DatabaseConfig = z.infer<typeof DatabaseConfigSchema>;\n *\n * // Create raw config from env vars (PreValidate allows undefined values)\n * const config: PreValidate<DatabaseConfig> = {\n *   url: process.env.DATABASE_URL,\n *   poolSize: process.env.DATABASE_POOL_SIZE,\n * };\n *\n * // Validate and export - throws at startup if DATABASE_URL is missing\n * export const databaseConfig = validateConfig(DatabaseConfigSchema, config);\n *\n * // Now use with full type safety\n * databaseConfig.url;      // string (guaranteed to exist)\n * databaseConfig.poolSize; // number (defaults to 10 if not set)\n * ```\n */\nexport function validateConfig<T extends z.ZodTypeAny>(\n  schema: T,\n  config: PreValidate<z.infer<T>>,\n): z.infer<T> {\n  const result = schema.safeParse(config);\n  if (!result.success) {\n    throw new InvalidConfigurationError(result.error.issues);\n  }\n  return result.data;\n}\n",
      "type": "registry:lib",
      "target": "lib/common/validate-config.ts"
    }
  ]
}
